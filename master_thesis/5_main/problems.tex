\section{Задача}

Маємо множину $T$ зображень.
Кольори --- відтінки сірого, що визначаються лише інтенсивністю від $0$ до $1$.
Введемо множину $I$ пікселів зображення.
Зображення $t \in T$ є відображення з множини пікселів на множину їх значень
\begin{equation*}
  t: I \rightarrow \left[ 0; 1 \right].
\end{equation*}
Інтенсивність пікселя $i$ в зображенні $t$ позначимо як $t_i$.

Взагалі кажучи, $I$ --- множина індексів матриць однакового розміру
\begin{equation*}
  I = \left\{ \langle i, j \rangle
    \;\middle|\; i = \overline{1..h},\; j = \overline{1..w}\right\}.
\end{equation*}
Зазвичай зображення можуть бути розміром від $100\times100=10^4$ пікселів.
Проте в середньому це значення досягає мільйона пікселів.
Це означає,
що при використанні $2^8=256$ градацій сірого маємо приблизно
$10^{6 \cdot 256}=10^{1536}$ різних зображень, тобто неймовірно багато.

Тривимірна модель обличчя визначається набором $n$ дійсних параметрів.
Множина всіх параметрів $X = \mathbb{R}^n$.
Функцією, що перетворює набір параметрів на зображення, є відображення
\begin{equation*}
  f: X \rightarrow T.
\end{equation*}
Введемо позначення для зображення згенерованого з певним набором параметрів $x$
\begin{equation*}
  f\left( x \right) = t.
\end{equation*}
Інтенсивність $i$ пікселя позначимо
\begin{equation*}
  f_i\left( x \right) = t_i.
\end{equation*}

Поставимо Баєсову задачу розпізнавання.
Для цього потрібно визначитися з функцією витрат
\cite{berger2013statistical}
\begin{equation*}
  W: X \times X \rightarrow \mathbb{R}.
\end{equation*}
Введемо невідому функцию $q$, яку будемо шукати.
Вона за пред'явленим зображенням $t$ буде повертати набір параметрів $x$,
які краще за все описують модель данного обличчя
\begin{equation*}
  q\left( t \right) = x.
\end{equation*}
Математичне очікування функції витрат для даного вирішального правила $q$
як функції випадкової величини $x$ за умови,
що було пред'явлено зображення $t$, називається Баєсовим ризиком
\begin{equation*}
  R \left( q \right)
  = \sum\limits_{t \in T} \sum\limits_{x \in X}
    \mathbb{P} \left( x,  q\left( t \right) \right)
    \cdot W \left( x, q\left( t \right) \right).
\end{equation*}
Задача
\begin{equation*}
  q^* = \argmin_q R.
\end{equation*}

Введемо ймовірність того,
що дане зображення $t$ було отримано саме з параметрами $x$.
Вважаємо, що на зображенні присутній нормальний шум з дисперсією $\sigma^2$
\begin{equation*}
  \mathbb{P}\left( x \mid t \right)
  = \prod_{i \in I}
    \frac{\exp{\left\{- \frac{\left( t_i - f_i\left( x \right) \right)^2}
           {2 \cdot \sigma^2} \right\}}}
           {\sqrt{2 \cdot \pi \cdot \sigma^2}}.
\end{equation*}

\subsection{Bin}

\begin{equation*}
  W \left( x, x' \right)
  = \mathbbm{1} \left( x = x' \right)
\end{equation*}

\begin{equation*}
  q^* \left( t \right)
  = \argmax_x \mathbb{P} \left( x \mid  t \right)
\end{equation*}

\subsection{Parameters difference}

\begin{equation*}
  W \left( x, x' \right)
  = \left\| x - x' \right\|
  = \sum_{p \in P} \left( x_p - x'_p \right)^2
\end{equation*}

\begin{equation*}
  q^* \left( t \right)
  = \sum_{x \in X} x \cdot \mathbb{P}\left( x \mid t \right)
\end{equation*}

\subsection{Models difference}

\begin{equation*}
  M_v\left( k \right) = \sum_{p \in P} \alpha_p^v \cdot k_p, \qquad v \in V
\end{equation*}

\begin{equation*}
    \begin{split}
      W \left( x, x' \right)
      = \left\| M\left( x \right) - M\left( x' \right) \right\|
      = \sum_{v \in V} \left[
          M_v\left( x \right) - M_v\left( x' \right)
        \right]^2 = \\
      = \sum_{v \in V} \sum_{p \in P} \left[
          \alpha_p^v \cdot \left( x_p - x'_p \right)
        \right]^2
      = \sum_{p \in P} \left\{ \left( x_p - x'_p \right)^2
        \cdot \sum_{v \in V} \left( \alpha_p^v \right)^2 \right\} = \\
      = \left| \beta_p^2 = \sum_{v \in V} \left( \alpha_p^v \right)^2 \right|
      = \sum_{p \in P}
          \beta_p^2 \cdot \left( x_p - x'_p \right)^2
    \end{split}
\end{equation*}

\begin{equation*}
  q^* \left( t \right)
  = M^{-1} \left(
      \sum_{x \in X} M\left( x \right) \cdot \mathbb{P}\left( x \mid t \right)
    \right)
\end{equation*}

\subsection{Gaussian parameters difference}

\begin{equation*}
  \mathbb{P}\left( x \mid t \right)
  = \prod_{i \in I}
    \frac{\exp{\left\{ - \frac{\left( t_i - f_i\left( x \right) \right)^2}
         {2 \cdot \sigma^2} \right\}}}{\sqrt{2 \cdot \pi \cdot \sigma^2}}
    \cdot
    \prod_{p \in P}
    \frac{\exp{\left( - \frac{x_p^2}{2} \right)}}{\sqrt{2 \cdot \pi}}
\end{equation*}

\begin{equation*}
  c = \left( 2 \cdot \pi \right)^{\frac{\left| I \right| + \left| P \right|}{2}}
      \cdot \sigma^{\left| I \right|}
\end{equation*}

\begin{equation*}
    \mathbb{P}\left( x \mid t \right)
    = c
      \cdot \exp{\left\{ - \frac{\left\| t - f\left( x \right) \right\|}
                                {2 \cdot \sigma^2} \right\}}
      \cdot \exp{\left\{ - \frac{\left\| x \right\|}{2} \right\}}
\end{equation*}

\begin{equation*}
  W \left( x, x' \right)
  = \left\| x - x' \right\|
  = \sum_{p \in P} \left( x_p - x'_p \right)^2
\end{equation*}

\begin{equation*}
  q^* \left( t \right)
  = c
    \cdot \sum_{x \in X}
      x
      \cdot \exp{\left\{ - \frac{\left\| x \right\|}{2} \right\}}
      \cdot \exp{\left\{ - \frac{\left\| t - f\left( x \right) \right\|}
                                {2 \cdot \sigma^2} \right\}}
\end{equation*}
