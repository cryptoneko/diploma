\section{Метод Монте-Карло}

Оскільки функція $f$, що дає зображення $t$ для даного набору параметрів $x$,
є складно влаштованою, вона не представлена в явному вигляді.
Інтегрування виразу, що містить цю функцію, не може бути проведено аналітично.
Метод Монте-Карло --- чисельний метод, що підходить до розв'язку даної задачі.

Маємо інтеграл
\begin{equation*}
  q^* \left( t \right)
  = c_t
    \cdot \int\limits_{x \in X}
      x
      \cdot \exp{\left\{ - \frac{\left\| t - f\left( x \right) \right\|^2}
                                {2 \cdot \sigma^2} \right\}}
      \cdot \exp{\left\{ - \frac{\left\| x \right\|^2}{2} \right\}}
    d\,x,
\end{equation*}
який є математичним очікуванням функції
стандартного гаусового $n$-вимірного вектора
\begin{equation*}
  q^* \left( t \right)
  = \left( 2 \cdot \pi \cdot \sigma^2 \right)^{\frac{w \cdot h}{2}}
    \cdot M_{\xi}\left[
      \xi
      \cdot \exp{\left\{ - \frac{\left\| t - f\left( \xi \right) \right\|^2}
        {2 \cdot \sigma^2} \right\}} \right], \qquad
    \xi \sim \mathcal{N}\left( 0, 1 \right).
\end{equation*}
Внесемо все в експоненту
\begin{equation*}
  q^* \left( t \right)
  = M_{\xi}\left[
    \frac{\xi}{\left| \xi \right|}
    \cdot \exp{\left\{
        \frac{w \cdot h}{2}
          \cdot \left( \ln{2} + \ln{\pi} + \ln{\sigma^2} \right)
        + \ln{\left| \xi \right|}
        - \frac{\left\| t - f\left( \xi \right) \right\|^2}
        {2 \cdot \sigma^2} \right\}
    } \right].
\end{equation*}
Щоб його розрахувати,
потрібно згенерувати набори з $n$ незалежних випадкових величин,
що мають стандартний нормальний розподіл,
для кожного набору розрахувати значення виразу,
математичне очікування якого потрібно визначити,
просумувати та поділити на кількість спроб.
Перед цим потрібно оцінити дисперсію шуму $\sigma^2$ на зображенні $t$.

Припустимо,
потрібно з ймовірністю не меншою за $0.99$
знайти оцінку інтеграла з похибкою не більшою за $\varepsilon = 0.01$.
Введемо допоміжні величини
\begin{equation*}
  \begin{split}
    z^2_{\gamma} = \Phi\left( 0.99 \right)^2 = 2.575^2, \\
    \varepsilon^2 = 0.01^2.
  \end{split}
\end{equation*}
Розрахуємо суму отриманих значень та суму їх квадратів
\begin{equation*}
  \begin{split}
    M\left( N \right) = \sum_{i=1}^{N} \left(
        \hat{Q}^{\left( i \right)}\left( x \right)
      \right)^2, \\
    S\left( N \right) = \sum_{i=1}^{N} \left(
        \hat{Q}^{\left( i \right)}\left( x \right)
      \right).
  \end{split}
\end{equation*}
Маємо оцінку математичного очікування та дисперсії інтегралу
\begin{equation*}
  \begin{split}
    \hat{V}^2_N = \frac{1}{N-1}
      \cdot \left[ M\left( N \right) - \frac{1}{N}
      \cdot \left( S\left( N \right) \right) \right], \\
    \hat{Q}^2_N = \left( \frac{1}{N} \cdot S\left( N \right) \right). \\
  \end{split}
\end{equation*}
Кількість необхідних ітерацій $N^*$ рахується за формулою
\begin{equation*}
  N^* = \min{\left\{ N \;\middle|\;
    N > \frac{z^2_{\gamma} \cdot \hat{V}^2_N}
    {\varepsilon^2 \cdot \hat{Q}^2_N} \right\}}.
\end{equation*}
